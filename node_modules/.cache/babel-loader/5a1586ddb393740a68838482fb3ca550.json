{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\Bill Quan\\\\Desktop\\\\fit3171\\\\fit4002\\\\rr1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Bill Quan\\\\Desktop\\\\fit3171\\\\fit4002\\\\rr1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Bill Quan\\\\Desktop\\\\fit3171\\\\fit4002\\\\rr1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Bill Quan\\\\Desktop\\\\fit3171\\\\fit4002\\\\rr1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import ReactDOM from\"react-dom\";import scriptLoader from\"react-async-script-loader\";import UserService from\"../services/user.service\";import AuthService from\"../services/auth.service\";var CLIENT={sandbox:\"AbbtfecBeODkTGclTYhScc1J_MrroFd1g6XJ0gRGwoHXY-Lef2GmgiRaRtgeIISolOCCfB6XmqDAzQHB\",production:\"your_production_key\"};var CLIENT_ID=process.env.NODE_ENV===\"production\"?CLIENT.production:CLIENT.sandbox;var CURRENCY=\"AUD\";var PayPalButton=null;var PaypalButton=/*#__PURE__*/function(_React$Component){_inherits(PaypalButton,_React$Component);var _super=_createSuper(PaypalButton);function PaypalButton(props){var _this;_classCallCheck(this,PaypalButton);_this=_super.call(this,props);_this.createOrder=function(data,actions){return actions.order.create({purchase_units:[{description:_this.props.title,amount:{currency_code:\"AUD\",value:_this.props.cost}}]});};_this.onApprove=function(data,actions){actions.order.capture().then(function(details){var paymentData={payerID:data.payerID,orderID:data.orderID};console.log(\"Payment Approved: \",paymentData);UserService.enrollCourse(AuthService.getCurrentUser().id,_this.props.courseId,_this.props.cost,data.payerID,data.orderID).then(function(response){if(response.data.status===\"completed\"){AuthService.refreshCurrentUser().then(function(){_this.setState({showButtons:false,paid:true,failed:false});},function(error){var resMessage=error.response&&error.response.data&&error.response.data.message||error.message||error.toString();_this.setState({loading:false,message:resMessage});});}else if(response.data.status===\"unsuccessful\"){_this.setState({showButtons:false,paid:false,failed:true});}else{_this.setState({showButtons:false,error:true});}console.log(response.data);}).catch(function(error){console.log(error);});});};_this.state={showButtons:false,failed:false,paid:false,error:false};window.React=React;window.ReactDOM=ReactDOM;return _this;}_createClass(PaypalButton,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props=this.props,isScriptLoaded=_this$props.isScriptLoaded,isScriptLoadSucceed=_this$props.isScriptLoadSucceed;if(isScriptLoaded&&isScriptLoadSucceed){PayPalButton=window.paypal.Buttons.driver(\"react\",{React:React,ReactDOM:ReactDOM});this.setState({showButtons:true});}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(nextProps){var isScriptLoaded=nextProps.isScriptLoaded,isScriptLoadSucceed=nextProps.isScriptLoadSucceed;var scriptJustLoaded=!this.state.showButtons&&!this.props.isScriptLoaded&&isScriptLoaded;if(scriptJustLoaded){if(isScriptLoadSucceed){PayPalButton=window.paypal.Buttons.driver(\"react\",{React:React,ReactDOM:ReactDOM});this.setState({showButtons:true});}}}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,showButtons=_this$state.showButtons,paid=_this$state.paid,failed=_this$state.failed,error=_this$state.error;return/*#__PURE__*/React.createElement(\"div\",{className:\"main\"},showButtons&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",null,\"Course: \",this.props.title),/*#__PURE__*/React.createElement(\"h2\",null,\"Cost\\uFF1A \",this.props.cost,\" AUD\")),/*#__PURE__*/React.createElement(PayPalButton,{createOrder:function createOrder(data,actions){return _this2.createOrder(data,actions);},onApprove:function onApprove(data,actions){return _this2.onApprove(data,actions);}})),paid&&/*#__PURE__*/React.createElement(\"div\",{className:\"main\"},/*#__PURE__*/React.createElement(\"img\",{alt:\"Happy picture here\"}),/*#__PURE__*/React.createElement(\"h2\",null,\"Congrats! you are now enrolled in  \",this.props.title,\" \")),failed&&/*#__PURE__*/React.createElement(\"div\",{className:\"main\"},/*#__PURE__*/React.createElement(\"img\",{alt:\"Sad\"}),/*#__PURE__*/React.createElement(\"h2\",null,\"Sorry, your payment seems to be failed. Please try again.\"),/*#__PURE__*/React.createElement(\"h2\",null,\"If you meet any problem, please contact admins.\")),error&&/*#__PURE__*/React.createElement(\"div\",{className:\"main\"},/*#__PURE__*/React.createElement(\"img\",{alt:\"Sad\"}),/*#__PURE__*/React.createElement(\"h2\",null,\"An error has occured. We're really sorry for the inconvinience!\"),/*#__PURE__*/React.createElement(\"h2\",null,\"If the transaction has been completed, please contact our admins. Otherwise, please try again.\")));}}]);return PaypalButton;}(React.Component);export default scriptLoader(\"https://www.paypal.com/sdk/js?client-id=\".concat(CLIENT_ID,\"&currency=\").concat(CURRENCY))(PaypalButton);","map":{"version":3,"sources":["C:/Users/Bill Quan/Desktop/fit3171/fit4002/rr1/src/CoursePage/PaypalButton.js"],"names":["React","ReactDOM","scriptLoader","UserService","AuthService","CLIENT","sandbox","production","CLIENT_ID","process","env","NODE_ENV","CURRENCY","PayPalButton","PaypalButton","props","createOrder","data","actions","order","create","purchase_units","description","title","amount","currency_code","value","cost","onApprove","capture","then","details","paymentData","payerID","orderID","console","log","enrollCourse","getCurrentUser","id","courseId","response","status","refreshCurrentUser","setState","showButtons","paid","failed","error","resMessage","message","toString","loading","catch","state","window","isScriptLoaded","isScriptLoadSucceed","paypal","Buttons","driver","nextProps","scriptJustLoaded","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport scriptLoader from \"react-async-script-loader\";\r\nimport UserService from \"../services/user.service\";\r\nimport AuthService from \"../services/auth.service\";\r\n const CLIENT = {\r\n   sandbox:\r\n     \"AbbtfecBeODkTGclTYhScc1J_MrroFd1g6XJ0gRGwoHXY-Lef2GmgiRaRtgeIISolOCCfB6XmqDAzQHB\",\r\n   production:\r\n     \"your_production_key\"\r\n };\r\n\r\n const CLIENT_ID =\r\n   process.env.NODE_ENV === \"production\" ? CLIENT.production : CLIENT.sandbox;\r\n const CURRENCY = \"AUD\";\r\n\r\nlet PayPalButton = null;\r\nclass PaypalButton extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      showButtons: false,\r\n      failed: false,\r\n      paid: false,\r\n      error: false\r\n    };\r\n\r\n    window.React = React;\r\n    window.ReactDOM = ReactDOM;\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { isScriptLoaded, isScriptLoadSucceed } = this.props;\r\n\r\n    if (isScriptLoaded && isScriptLoadSucceed) {\r\n      PayPalButton = window.paypal.Buttons.driver(\"react\", { React, ReactDOM });\r\n      this.setState({ showButtons: true });\r\n    }\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    const { isScriptLoaded, isScriptLoadSucceed } = nextProps;\r\n\r\n    const scriptJustLoaded =\r\n      !this.state.showButtons && !this.props.isScriptLoaded && isScriptLoaded;\r\n\r\n    if (scriptJustLoaded) {\r\n      if (isScriptLoadSucceed) {\r\n        PayPalButton = window.paypal.Buttons.driver(\"react\", {\r\n          React,\r\n          ReactDOM\r\n        });\r\n        this.setState({ showButtons: true });\r\n      }\r\n    }\r\n  }\r\n  createOrder = (data, actions) => {\r\n\r\n    return actions.order.create({\r\n      purchase_units: [\r\n        {\r\n          description: this.props.title,\r\n          amount: {\r\n            currency_code: \"AUD\",\r\n            value: this.props.cost\r\n          }\r\n        }\r\n      ]\r\n    });\r\n  };\r\n\r\n  onApprove = (data, actions) => {\r\n\r\n    actions.order.capture().then(details => {\r\n      const paymentData = {\r\n        payerID: data.payerID,\r\n        orderID: data.orderID\r\n      };  \r\n      console.log(\"Payment Approved: \", paymentData);\r\n      UserService.enrollCourse(AuthService.getCurrentUser().id,this.props.courseId,this.props.cost,data.payerID,data.orderID).then(\r\n          response => {\r\n            if (response.data.status === \"completed\"){\r\n              AuthService.refreshCurrentUser().then(\r\n                  () => {\r\n                    this.setState({ showButtons: false, paid: true ,failed: false});\r\n                  },\r\n                  error => {\r\n                    const resMessage =\r\n                        (error.response &&\r\n                            error.response.data &&\r\n                            error.response.data.message) ||\r\n                        error.message ||\r\n                        error.toString();\r\n\r\n                    this.setState({\r\n                      loading: false,\r\n                      message: resMessage\r\n                    });\r\n                  }\r\n              );\r\n            }else if (response.data.status === \"unsuccessful\"){\r\n              this.setState({ showButtons: false, paid: false ,failed: true});\r\n            }else{\r\n              this.setState({ showButtons: false, error:true});\r\n            }\r\n            console.log(response.data);\r\n          },\r\n      ).catch((error) => {\r\n        console.log(error);\r\n      });\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { showButtons,paid, failed , error} = this.state;\r\n\r\n    return (\r\n      <div className=\"main\">\r\n        {showButtons && (\r\n          <div>\r\n            <div>\r\n              <h2>Course: {this.props.title}</h2>\r\n              <h2>Cost： {this.props.cost} AUD</h2>\r\n            </div>\r\n\r\n            <PayPalButton\r\n              createOrder={(data, actions) => this.createOrder(data, actions)}\r\n              onApprove={(data, actions) => this.onApprove(data, actions)}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {paid && (\r\n          <div className=\"main\">\r\n            <img alt=\"Happy picture here\"  />\r\n            <h2>\r\n        Congrats! you are now enrolled in  {this.props.title}{\" \"}\r\n\r\n            </h2>\r\n          </div>\r\n        )}\r\n\r\n    {failed && (\r\n    <div className=\"main\">\r\n        <img alt=\"Sad\"  />\r\n        <h2>\r\n        Sorry, your payment seems to be failed. Please try again.\r\n    </h2>\r\n    <h2>\r\n    If you meet any problem, please contact admins.\r\n    </h2>\r\n    </div>\r\n    )}\r\n    {error && (\r\n    <div className=\"main\">\r\n        <img alt=\"Sad\"  />\r\n        <h2>\r\n        An error has occured. We're really sorry for the inconvinience!\r\n    </h2>\r\n    <h2>\r\n    If the transaction has been completed, please contact our admins. Otherwise, please try again.\r\n    </h2>\r\n    </div>\r\n    )}\r\n\r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n\r\n\r\n export default scriptLoader(`https://www.paypal.com/sdk/js?client-id=${CLIENT_ID}&currency=${CURRENCY}`)(PaypalButton);\r\n"]},"metadata":{},"sourceType":"module"}